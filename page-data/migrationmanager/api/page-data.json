{"componentChunkName":"component---src-pages-migrationmanager-api-mdx","path":"/migrationmanager/api/","result":{"pageContext":{"frontmatter":{"title":"Migration Manager APIs"},"relativePagePath":"/migrationmanager/api.mdx","titleType":"append","MdxNode":{"id":"744a870c-8181-5ee7-8747-5d128bc23e68","children":[],"parent":"afc1c378-b79a-58f3-a02b-2b98ac35432c","internal":{"content":"---\ntitle: Migration Manager APIs\n---\n\nMigration manager apis (part of 7613 and 8.x) helps move migration packages from a source maximo to target maximo. To facilitate this we have opened up set of rest apis as described below. Note that these apis are designed to handle MM Changes and Snapshot and not migration collections at this point. Also note that these apis are not designed to define a package – which should be done by the customer SME as part of MM setup. The apis are listed below\n\n## Create a MM package from a package definition\n\nThis is used to create a package from a package definition. \n\n```\nPOST /dm/create\nApikey:<apikey value>\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\",\n  \"readme\": \"moving scripts\"\n}\n```\n\nThe response will have the newly created package json with the dmpackageid – which should be used in the next call `/dm/distribute`\n\nThe response json will be a representation of the newly created dmpackage – shown below.\n\n```json\n{\n  \"dmpackageid\": 123,\n  \"source\": \"the source env identifier\",\n  \"status\": \"the status of the package – created/deployed etc – look for the internal value\",\n  \"filename\": \" the name of the file when we download this package\",\n  \"readme\": \"the memo for the created package\",\n  \"createdate\": \"the creation timestamp\",\n  \"createby\": \" the user id that created this package\",\n  \"pkgdefname\": \" the package definition name\",\n  \"progressstatus\": \"..\"\n}\n```\n\n\n## Distribute the newly created MM Package\n\nThis call is used to distribute the package created in the previous step. Distribution is done to a target that is predefined. Targets can be file targets of database targets. In this api, you can choose the target to deploy this package or let the framework choose all possible targets. \n```\nPOST /dm/distribute\n```\nWith the post body as below.\n```json\n{\n     \"pkgdefname\":\"TESTDD\",\n     \"dmpackageid\":31,\n     \"targetname\": \"mytarget\"\n}\n```\n\nNote that the \"targetname\" property is optional and if not provided, will end up distributing this package to all available targets as defined for this package definition.\nThe response is the same as the create api ie it's the representation of modified DMPACKAGE object after the distribution is done. This json representation will also have an additional element \"distributionmessage\" which is the message that the MM framework generates after a successful distribution.\n\n\n## Downloading the package\n\nOnce the package is distributed to the target folder, we will need to download the package for uploading it to the target environment. Note that this step is not needed if the target is the target Maximo's database. In that case, the download and upload steps should be skipped. \n\n```\nGET /dm/download?dmpackagedef=TESTDD&dmpackageid=31\n```\n\nThis responds with the package zip. The client code can then upload this zip file to the target Maximo using the next api.\n\n\n## Uploading the zipped package\n\n```\nPOST <target Maximo api url>/dm/upload?filename=<the downloaded package zip file name>\n<<the zipped package>>\n```\n\nThis uploads the package to the target Maximo.\n\n\n## Deploy the package in the target Maximo\n\nNext step would be to deploy the uploaded package. Note that we can simply jump to this step if we distributed the package to the target Maximo db in the \"distribute\" step. \n\n```\nPOST /dm/deploy\n```\n\nThe successful response would be a json object with a property called \"warningmsg\" that will have the combined status message as displayed in the classic Maximo UI after a deployment. An error response can also arise for the reasons below:\n\n1.\tIf there is a issue with the package data that fails the target system validation.\n2.\tThere is a need for admin mode to be turned on for this deployment.\n\nFor both cases the api response would be an error object. For #1, there is no option but to fix the data and recreate the package. But in case of admin mode error (#2), the client should be able to identify the error code (BMXAA0578E) and make the needed calls to setup the admin mode and then call the `/dm/completedeploy` api and then turn the admin mode off. We will cover those apis below. Note that for #2, the error json will contain the dmpackageid for the failed package. \n\nBelow is a sample error json\n```json\n{\n  \"Error\":{\n\t\"errorattrname\": \"dmpackageid\",\n\t\"extendedError\":{\n\t\t\"moreInfo\":{\n\t\t\t\"href\": \"http://localhost:7001/maximo/oslc/error/messages/BMXAA0578E\"\n\t\t}\n\t},\n\t\"errattrvalue\": \"31\",\n\t\"reasonCode\": \"BMXAA0578E\",\n\t\"message\": \"…..\",\n\t\"statusCode\": \"400\"\n\t}\n}\n```\n\n\n## Turning the admin mode on\n\n```\nPOST /adminmode/on\n```\nWith the post body as below.\n```json\n{\n  \"numsessions\": 5,\n  \"logoutmin\": 1\n}\n```\nThe response should be a 200 OK.\n\n\n## Checking the state of the admin mode\n\n```\nGET /adminmode/state\n```\n\nThis will return a json containing the state value of 0,1,2. The client code should be looking for a value of 1 – which implies that the admin mode is on. The value of 2 would indicate that its still pending. \n\n\n## Completing the deployment\n\nThis api would be called in to complete the deployment that got interrupted due to admin mode requirement. \n\n```\nPOST /dm/completedeploy\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\",\n  \"dmpackageid\": <the id returned as part of the error response>\n}\n```\n\n\n## Turning the admin mode off\n\n```\nPOST /adminmode/off\n```\n\nTurns the admin mode off. The client should do this after the package deployment is complete. \n\n\n## Reset the event tracking history for Change\n\n```\nPOST /dm/reset\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\"\n}\n```\n\nThis is a design choice meant to not repeat the same events after they have been migrated.\n\n\n## Toggle the active flag for Change\n\nOnce a CHANGE package is created and distributed, the event listener gets de-activated. This api is used to reactive that.\n```\nPOST /dm/toggleactive\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\"\n}\n```\n\n\n## Close the package\n\nUsed for cleanup – after the package content has been donloaded.\n```\nPOST /dm/close\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\",\n  \"dmpackageid\": 123\n}\n```\nResponse will the json representation of the DMPACKAGE that got closed.\n\n\n## Delete the package\n\nUsed for cleanup – after the package content has been downloaded.\n\n```\nPOST /dm/delete\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\",\n  \"dmpackageid\": 123\n}\n```","type":"Mdx","contentDigest":"a950afa06cb057889228c7bf8e716219","owner":"gatsby-plugin-mdx","counter":169},"frontmatter":{"title":"Migration Manager APIs"},"exports":{},"rawBody":"---\ntitle: Migration Manager APIs\n---\n\nMigration manager apis (part of 7613 and 8.x) helps move migration packages from a source maximo to target maximo. To facilitate this we have opened up set of rest apis as described below. Note that these apis are designed to handle MM Changes and Snapshot and not migration collections at this point. Also note that these apis are not designed to define a package – which should be done by the customer SME as part of MM setup. The apis are listed below\n\n## Create a MM package from a package definition\n\nThis is used to create a package from a package definition. \n\n```\nPOST /dm/create\nApikey:<apikey value>\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\",\n  \"readme\": \"moving scripts\"\n}\n```\n\nThe response will have the newly created package json with the dmpackageid – which should be used in the next call `/dm/distribute`\n\nThe response json will be a representation of the newly created dmpackage – shown below.\n\n```json\n{\n  \"dmpackageid\": 123,\n  \"source\": \"the source env identifier\",\n  \"status\": \"the status of the package – created/deployed etc – look for the internal value\",\n  \"filename\": \" the name of the file when we download this package\",\n  \"readme\": \"the memo for the created package\",\n  \"createdate\": \"the creation timestamp\",\n  \"createby\": \" the user id that created this package\",\n  \"pkgdefname\": \" the package definition name\",\n  \"progressstatus\": \"..\"\n}\n```\n\n\n## Distribute the newly created MM Package\n\nThis call is used to distribute the package created in the previous step. Distribution is done to a target that is predefined. Targets can be file targets of database targets. In this api, you can choose the target to deploy this package or let the framework choose all possible targets. \n```\nPOST /dm/distribute\n```\nWith the post body as below.\n```json\n{\n     \"pkgdefname\":\"TESTDD\",\n     \"dmpackageid\":31,\n     \"targetname\": \"mytarget\"\n}\n```\n\nNote that the \"targetname\" property is optional and if not provided, will end up distributing this package to all available targets as defined for this package definition.\nThe response is the same as the create api ie it's the representation of modified DMPACKAGE object after the distribution is done. This json representation will also have an additional element \"distributionmessage\" which is the message that the MM framework generates after a successful distribution.\n\n\n## Downloading the package\n\nOnce the package is distributed to the target folder, we will need to download the package for uploading it to the target environment. Note that this step is not needed if the target is the target Maximo's database. In that case, the download and upload steps should be skipped. \n\n```\nGET /dm/download?dmpackagedef=TESTDD&dmpackageid=31\n```\n\nThis responds with the package zip. The client code can then upload this zip file to the target Maximo using the next api.\n\n\n## Uploading the zipped package\n\n```\nPOST <target Maximo api url>/dm/upload?filename=<the downloaded package zip file name>\n<<the zipped package>>\n```\n\nThis uploads the package to the target Maximo.\n\n\n## Deploy the package in the target Maximo\n\nNext step would be to deploy the uploaded package. Note that we can simply jump to this step if we distributed the package to the target Maximo db in the \"distribute\" step. \n\n```\nPOST /dm/deploy\n```\n\nThe successful response would be a json object with a property called \"warningmsg\" that will have the combined status message as displayed in the classic Maximo UI after a deployment. An error response can also arise for the reasons below:\n\n1.\tIf there is a issue with the package data that fails the target system validation.\n2.\tThere is a need for admin mode to be turned on for this deployment.\n\nFor both cases the api response would be an error object. For #1, there is no option but to fix the data and recreate the package. But in case of admin mode error (#2), the client should be able to identify the error code (BMXAA0578E) and make the needed calls to setup the admin mode and then call the `/dm/completedeploy` api and then turn the admin mode off. We will cover those apis below. Note that for #2, the error json will contain the dmpackageid for the failed package. \n\nBelow is a sample error json\n```json\n{\n  \"Error\":{\n\t\"errorattrname\": \"dmpackageid\",\n\t\"extendedError\":{\n\t\t\"moreInfo\":{\n\t\t\t\"href\": \"http://localhost:7001/maximo/oslc/error/messages/BMXAA0578E\"\n\t\t}\n\t},\n\t\"errattrvalue\": \"31\",\n\t\"reasonCode\": \"BMXAA0578E\",\n\t\"message\": \"…..\",\n\t\"statusCode\": \"400\"\n\t}\n}\n```\n\n\n## Turning the admin mode on\n\n```\nPOST /adminmode/on\n```\nWith the post body as below.\n```json\n{\n  \"numsessions\": 5,\n  \"logoutmin\": 1\n}\n```\nThe response should be a 200 OK.\n\n\n## Checking the state of the admin mode\n\n```\nGET /adminmode/state\n```\n\nThis will return a json containing the state value of 0,1,2. The client code should be looking for a value of 1 – which implies that the admin mode is on. The value of 2 would indicate that its still pending. \n\n\n## Completing the deployment\n\nThis api would be called in to complete the deployment that got interrupted due to admin mode requirement. \n\n```\nPOST /dm/completedeploy\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\",\n  \"dmpackageid\": <the id returned as part of the error response>\n}\n```\n\n\n## Turning the admin mode off\n\n```\nPOST /adminmode/off\n```\n\nTurns the admin mode off. The client should do this after the package deployment is complete. \n\n\n## Reset the event tracking history for Change\n\n```\nPOST /dm/reset\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\"\n}\n```\n\nThis is a design choice meant to not repeat the same events after they have been migrated.\n\n\n## Toggle the active flag for Change\n\nOnce a CHANGE package is created and distributed, the event listener gets de-activated. This api is used to reactive that.\n```\nPOST /dm/toggleactive\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\"\n}\n```\n\n\n## Close the package\n\nUsed for cleanup – after the package content has been donloaded.\n```\nPOST /dm/close\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\",\n  \"dmpackageid\": 123\n}\n```\nResponse will the json representation of the DMPACKAGE that got closed.\n\n\n## Delete the package\n\nUsed for cleanup – after the package content has been downloaded.\n\n```\nPOST /dm/delete\n```\nWith the post body as below.\n```json\n{\n  \"pkgdefname\": \"TESTDD\",\n  \"dmpackageid\": 123\n}\n```","fileAbsolutePath":"/home/travis/build/maximo-app-framework/maximo-restapi-documentation/src/pages/migrationmanager/api.mdx"}}},"staticQueryHashes":["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}